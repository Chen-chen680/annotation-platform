<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºèƒ½æ•°æ®æ ‡æ³¨å¹³å°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            box-shadow: 0 0 40px rgba(0,0,0,0.2);
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 16px;
        }
        
        .nav-tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
            overflow-x: auto;
        }
        
        .nav-tab {
            padding: 15px 25px;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 15px;
            font-weight: 500;
            color: #6c757d;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            white-space: nowrap;
            min-width: 120px;
        }
        
        .nav-tab:hover {
            background: #e9ecef;
            color: #495057;
        }
        
        .nav-tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
            background: white;
        }
        
        .content {
            padding: 30px;
            max-height: calc(100vh - 140px);
            overflow-y: auto;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* é¡¹ç›®ç®¡ç†é¡µé¢æ ·å¼ */
        .project-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .project-card {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .project-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
            border-color: #667eea;
        }
        
        .project-title {
            font-size: 20px;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
        }
        
        .project-description {
            color: #6c757d;
            margin-bottom: 15px;
            line-height: 1.5;
        }
        
        .project-stats {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
            color: #6c757d;
        }
        
        .project-progress {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .progress-bar-small {
            width: 60px;
            height: 6px;
            background: #e9ecef;
            border-radius: 3px;
            overflow: hidden;
        }
        
        .progress-fill-small {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.3s ease;
        }
        
        .create-project-card {
            border: 2px dashed #dee2e6;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            color: #6c757d;
            background: #f8f9fa;
        }
        
        .create-project-card:hover {
            border-color: #667eea;
            color: #667eea;
            background: #f0f3ff;
        }
        
        .create-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }
        
        /* è¡¨å•æ ·å¼ */
        .form-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid #e9ecef;
        }
        
        .section-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 20px;
            color: #495057;
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 10px;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-label {
            font-weight: 500;
            color: #495057;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .form-control {
            padding: 12px 16px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
            background: white;
        }
        
        .form-control:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        
        .btn-outline {
            background: transparent;
            border: 2px solid #667eea;
            color: #667eea;
        }
        
        .btn-outline:hover {
            background: #667eea;
            color: white;
        }
        
        /* é¢„è§ˆæ•°æ®æ ·å¼ */
        .preview-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            border: 1px solid #e9ecef;
            margin-top: 20px;
        }
        
        .preview-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }
        
        .preview-table th,
        .preview-table td {
            padding: 12px;
            text-align: left;
            border: 1px solid #e9ecef;
            position: relative;
        }
        
        .preview-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #495057;
        }
        
        .editable-header {
            background: none;
            border: none;
            font-weight: 600;
            color: #495057;
            width: 100%;
            padding: 4px 8px;
            border-radius: 4px;
        }
        
        .editable-header:focus {
            outline: none;
            background: #fff;
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.3);
        }
        
        /* æ ‡æ³¨é…ç½®æ ·å¼ */
        .annotation-configs {
            display: grid;
            gap: 20px;
        }
        
        .annotation-config-card {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        
        .config-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #e9ecef;
        }
        
        .config-title {
            font-weight: 600;
            color: #495057;
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 10px;
        }
        
        .checkbox-group input[type="checkbox"] {
            width: 18px;
            height: 18px;
        }
        
        /* æ•°æ®è¡¨æ ¼æ ·å¼ */
        .data-table-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            border: 1px solid #e9ecef;
            overflow: hidden;
        }
        
        .table-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .pagination-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .table-wrapper {
            overflow-x: auto;
            max-height: 600px;
            border: 1px solid #e9ecef;
            border-radius: 8px;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
            table-layout: fixed;
        }
        
        .data-table th {
            background: #f8f9fa;
            padding: 12px;
            font-weight: 600;
            color: #495057;
            border-bottom: 2px solid #e9ecef;
            position: sticky;
            top: 0;
            z-index: 10;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .data-table td {
            padding: 12px;
            border-bottom: 1px solid #e9ecef;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            vertical-align: top;
        }
        
        .data-table tr:hover {
            background: #f8f9fa;
        }
        
        /* URLé“¾æ¥æ ·å¼ */
        .url-link {
            color: #667eea;
            text-decoration: underline;
            cursor: pointer;
            display: inline-block;
            max-width: 100%;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .url-link:hover {
            color: #5a67d8;
            background: rgba(102, 126, 234, 0.1);
            padding: 2px 4px;
            border-radius: 3px;
        }
        
        /* åˆ—å®½åº¦æ§åˆ¶ */
        .column-width-input {
            width: 80px;
            text-align: center;
        }
        
        /* é¢„è§ˆè¡¨æ ¼æ ·å¼ */
        .preview-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
            table-layout: fixed;
        }
        
        .preview-table th,
        .preview-table td {
            padding: 12px;
            text-align: left;
            border: 1px solid #e9ecef;
            position: relative;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .annotation-input {
            width: 100%;
            padding: 6px 10px;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            font-size: 13px;
        }
        
        .annotation-input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .annotation-label {
            display: block;
            font-size: 11px;
            color: #6c757d;
            margin-bottom: 4px;
            font-weight: 500;
        }
        
        /* æ¨¡æ€æ¡†æ ·å¼ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }
        
        .modal.active {
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            position: relative;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e9ecef;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #6c757d;
            padding: 5px;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .close-modal:hover {
            background: #f8f9fa;
            color: #495057;
        }
        
        /* ç»Ÿè®¡å¡ç‰‡æ ·å¼ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }
        
        .stat-value {
            font-size: 32px;
            font-weight: 700;
            margin: 10px 0;
        }
        
        .stat-label {
            font-size: 14px;
            opacity: 0.9;
        }
        
        /* é¢åŒ…å±‘å¯¼èˆª */
        .breadcrumb {
            background: #f8f9fa;
            padding: 10px 30px;
            border-bottom: 1px solid #e9ecef;
            font-size: 14px;
            color: #6c757d;
        }
        
        .breadcrumb a {
            color: #667eea;
            text-decoration: none;
        }
        
        .breadcrumb a:hover {
            text-decoration: underline;
        }
        
        /* é¡¹ç›®æœç´¢å’Œç­›é€‰ */
        .project-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .search-box {
            display: flex;
            align-items: center;
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 25px;
            padding: 8px 20px;
            transition: border-color 0.3s ease;
            min-width: 300px;
        }
        
        .search-box:focus-within {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .search-box input {
            border: none;
            outline: none;
            flex: 1;
            background: transparent;
            font-size: 14px;
        }
        
        .search-box .search-icon {
            color: #6c757d;
            margin-right: 10px;
        }
        
        /* é¡¹ç›®å¡ç‰‡ä¼˜åŒ– */
        .project-card {
            position: relative;
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .project-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
            border-color: #667eea;
        }
        
        .project-card-actions {
            position: absolute;
            top: 15px;
            right: 15px;
            display: flex;
            gap: 8px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .project-card:hover .project-card-actions {
            opacity: 1;
        }
        
        .action-btn {
            width: 32px;
            height: 32px;
            border: none;
            border-radius: 50%;
            background: rgba(255,255,255,0.9);
            color: #6c757d;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            transition: all 0.2s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .action-btn:hover {
            transform: scale(1.1);
            color: white;
        }
        
        .action-btn.edit:hover { background: #28a745; }
        .action-btn.delete:hover { background: #dc3545; }
        .action-btn.copy:hover { background: #17a2b8; }
        
        /* æ–‡ä»¶ä¸Šä¼ åŒºåŸŸä¼˜åŒ– */
        .upload-area {
            border: 2px dashed #dee2e6;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            background: #f8f9fa;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }
        
        .upload-area.dragover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.05);
        }
        
        .upload-area.has-file {
            border-color: #28a745;
            background: rgba(40, 167, 69, 0.05);
        }
        
        .upload-icon {
            font-size: 48px;
            color: #6c757d;
            margin-bottom: 15px;
            transition: color 0.3s ease;
        }
        
        .upload-area.dragover .upload-icon {
            color: #667eea;
        }
        
        .file-info {
            background: rgba(40, 167, 69, 0.1);
            border: 1px solid #28a745;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            text-align: left;
        }
        
        .file-info-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        
        /* é…ç½®å‘å¯¼æ ·å¼ */
        .config-wizard {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
        }
        
        .wizard-step {
            display: flex;
            align-items: center;
            padding: 10px 20px;
            background: #f8f9fa;
            color: #6c757d;
            border-radius: 25px;
            margin: 0 10px;
            font-weight: 500;
            position: relative;
        }
        
        .wizard-step.active {
            background: #667eea;
            color: white;
        }
        
        .wizard-step.completed {
            background: #28a745;
            color: white;
        }
        
        .wizard-step:not(:last-child)::after {
            content: 'â†’';
            position: absolute;
            right: -25px;
            color: #6c757d;
        }
        
        /* å¿«æ·æ“ä½œå·¥å…·æ  */
        .toolbar {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .toolbar-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .keyboard-shortcuts {
            font-size: 12px;
            color: #6c757d;
            background: #f8f9fa;
            padding: 5px 10px;
            border-radius: 15px;
        }
        
        /* åŠ è½½çŠ¶æ€ */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        
        .loading-overlay.show {
            display: flex;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-text {
            color: white;
            font-size: 16px;
            margin-top: 20px;
            text-align: center;
        }
        
        /* æ“ä½œåé¦ˆæç¤º */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #28a745;
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1001;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }
        
        .toast.show {
            transform: translateX(0);
        }
        
        .toast.error {
            background: #dc3545;
        }
        
        .toast.warning {
            background: #ffc107;
            color: #333;
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .content { padding: 15px; }
            .project-grid { grid-template-columns: 1fr; }
            .form-row { grid-template-columns: 1fr; }
            .stats-grid { grid-template-columns: 1fr 1fr; }
            .table-controls { flex-direction: column; align-items: stretch; }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 id="pageTitle">ğŸ¯ æ™ºèƒ½æ•°æ®æ ‡æ³¨å¹³å°</h1>
            <p id="pageSubtitle">åŸºäºé¡¹ç›®ç®¡ç†çš„é«˜æ•ˆæ•°æ®æ ‡æ³¨è§£å†³æ–¹æ¡ˆ</p>
        </div>
        
        <!-- é¢åŒ…å±‘å¯¼èˆª -->
        <div class="breadcrumb" id="breadcrumb">
            <a href="#" onclick="backToProjects()">é¡¹ç›®ç®¡ç†</a>
        </div>
        
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('projects', this)">ğŸ“ é¡¹ç›®ç®¡ç†</button>
            <button class="nav-tab" onclick="switchTab('upload', this)" id="uploadTab" style="display:none;">ğŸ“¤ æ•°æ®ä¸Šä¼ </button>
            <button class="nav-tab" onclick="switchTab('annotate', this)" id="annotateTab" style="display:none;">âœï¸ æ•°æ®æ ‡æ³¨</button>
            <button class="nav-tab" onclick="switchTab('export', this)" id="exportTab" style="display:none;">ğŸ“Š å¯¼å‡ºåˆ†æ</button>
        </div>
        
        <div class="content">
            <!-- é¡¹ç›®ç®¡ç†é¡µé¢ -->
            <div id="projects" class="tab-content active">
                <div class="project-controls">
                    <div class="search-box">
                        <span class="search-icon">ğŸ”</span>
                        <input type="text" placeholder="æœç´¢é¡¹ç›®..." id="projectSearch" onkeyup="searchProjects()">
                    </div>
                    <div>
                        <select class="form-control" id="projectSort" onchange="sortProjects()" style="width: 200px;">
                            <option value="updated_desc">æœ€è¿‘æ›´æ–°</option>
                            <option value="created_desc">åˆ›å»ºæ—¶é—´</option>
                            <option value="name_asc">åç§° A-Z</option>
                            <option value="progress_desc">å®Œæˆåº¦</option>
                        </select>
                    </div>
                </div>
                
                <div class="section-title">æˆ‘çš„é¡¹ç›® (<span id="projectCount">0</span>)</div>
                <div class="project-grid" id="projectGrid">
                    <div class="project-card create-project-card" onclick="showCreateProjectModal()">
                        <div class="create-icon">â•</div>
                        <div>åˆ›å»ºæ–°é¡¹ç›®</div>
                        <div style="font-size: 12px; color: #6c757d; margin-top: 10px;">
                            æ”¯æŒCSVã€TSVã€TXTæ ¼å¼
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- æ•°æ®ä¸Šä¼ é¡µé¢ -->
            <div id="upload" class="tab-content">
                <div class="config-wizard">
                    <div class="wizard-step active" id="step1">1. é€‰æ‹©æ–‡ä»¶</div>
                    <div class="wizard-step" id="step2">2. é¢„è§ˆæ•°æ®</div>
                    <div class="wizard-step" id="step3">3. é…ç½®åˆ—</div>
                    <div class="wizard-step" id="step4">4. å¼€å§‹æ ‡æ³¨</div>
                </div>
                
                <div class="form-section">
                    <div class="section-title">
                        ä¸Šä¼ æ•°æ®æ–‡ä»¶
                        <div style="float: right;">
                            <button class="btn btn-secondary" onclick="showReplaceFileModal()" id="replaceFileBtn" style="display: none;">
                                ğŸ”„ æ›¿æ¢æ–‡ä»¶
                            </button>
                        </div>
                    </div>
                    
                    <div class="toolbar">
                        <div class="toolbar-group">
                            <label class="form-label">ä¸Šä¼ æ–¹å¼ï¼š</label>
                            <select class="form-control" id="uploadType" onchange="toggleUploadMethod()" style="width: 150px;">
                                <option value="file">æœ¬åœ°æ–‡ä»¶</option>
                                <option value="url">URLä¸‹è½½</option>
                                <option value="ftp">FTPä¸‹è½½</option>
                            </select>
                        </div>
                        
                        <div class="toolbar-group">
                            <label class="form-label">åˆ†éš”ç¬¦ï¼š</label>
                            <select class="form-control" id="delimiter" onchange="toggleCustomDelimiter()" style="width: 120px;">
                                <option value=",">é€—å· (,)</option>
                                <option value="\t">åˆ¶è¡¨ç¬¦ (\t)</option>
                                <option value="|">ç«–çº¿ (|)</option>
                                <option value=";">åˆ†å· (;)</option>
                                <option value="custom">è‡ªå®šä¹‰</option>
                            </select>
                        </div>
                        
                        <div class="toolbar-group">
                            <label class="form-label">ç¼–ç ï¼š</label>
                            <select class="form-control" id="encoding" style="width: 120px;">
                                <option value="utf-8">UTF-8</option>
                                <option value="gbk">GBK</option>
                                <option value="gb2312">GB2312</option>
                                <option value="iso-8859-1">ISO-8859-1</option>
                                <option value="auto">è‡ªåŠ¨æ£€æµ‹</option>
                            </select>
                        </div>
                        
                        <div class="checkbox-group">
                            <input type="checkbox" id="hasHeader">
                            <label for="hasHeader">åŒ…å«è¡¨å¤´</label>
                        </div>
                    </div>
                    
                    <div id="customDelimiterGroup" style="display:none; margin-bottom: 20px;">
                        <label class="form-label">è‡ªå®šä¹‰åˆ†éš”ç¬¦ï¼š</label>
                        <input type="text" class="form-control" id="customDelimiter" placeholder="è¾“å…¥åˆ†éš”ç¬¦" style="width: 200px;">
                    </div>
                    
                    <!-- æ–‡ä»¶ä¸Šä¼ åŒºåŸŸ -->
                    <div id="fileUpload">
                        <div class="upload-area" id="uploadArea" ondrop="handleFileDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)">
                            <div class="upload-icon" id="uploadIcon">ğŸ“</div>
                            <h3 id="uploadTitle">æ‹–æ‹½æ–‡ä»¶åˆ°è¿™é‡Œæˆ–ç‚¹å‡»é€‰æ‹©</h3>
                            <p id="uploadSubtitle">æ”¯æŒ CSVã€TSVã€TXT æ ¼å¼æ–‡ä»¶</p>
                            <input type="file" id="dataFile" accept=".csv,.tsv,.txt" onchange="handleFileSelect(event)" style="display: none;">
                            <button class="btn btn-outline" onclick="document.getElementById('dataFile').click()">é€‰æ‹©æ–‡ä»¶</button>
                        </div>
                        
                        <div class="file-info" id="fileInfo" style="display: none;">
                            <h4>ğŸ“„ æ–‡ä»¶ä¿¡æ¯</h4>
                            <div class="file-info-item">
                                <span>æ–‡ä»¶å:</span>
                                <span id="fileName"></span>
                            </div>
                            <div class="file-info-item">
                                <span>æ–‡ä»¶å¤§å°:</span>
                                <span id="fileSize"></span>
                            </div>
                            <div class="file-info-item">
                                <span>æœ€åä¿®æ”¹:</span>
                                <span id="fileDate"></span>
                            </div>
                        </div>
                    </div>
                    
                    <div id="urlUpload" style="display:none;">
                        <label class="form-label">æ–‡ä»¶URLï¼š</label>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" class="form-control" id="dataUrl" placeholder="https://example.com/data.csv" style="flex: 1;">
                            <button class="btn btn-outline" onclick="testUrl()">æµ‹è¯•è¿æ¥</button>
                        </div>
                    </div>
                    
                    <div id="ftpUpload" style="display:none;">
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">FTPæœåŠ¡å™¨ï¼š</label>
                                <input type="text" class="form-control" id="ftpServer" placeholder="ftp.example.com">
                            </div>
                            <div class="form-group">
                                <label class="form-label">æ–‡ä»¶è·¯å¾„ï¼š</label>
                                <input type="text" class="form-control" id="ftpPath" placeholder="/path/to/file.csv">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">ç”¨æˆ·åï¼š</label>
                                <input type="text" class="form-control" id="ftpUser">
                            </div>
                            <div class="form-group">
                                <label class="form-label">å¯†ç ï¼š</label>
                                <input type="password" class="form-control" id="ftpPassword">
                            </div>
                        </div>
                        <button class="btn btn-outline" onclick="testFtpConnection()">æµ‹è¯•è¿æ¥</button>
                    </div>
                    
                    <div style="margin-top: 20px; text-align: center;">
                        <button class="btn btn-primary" onclick="uploadData()" id="uploadBtn">
                            ğŸ“¤ ä¸Šä¼ å¹¶è§£æ
                        </button>
                    </div>
                </div>
                
                <div id="previewSection" style="display:none;" class="preview-section">
                    <div class="section-title">
                        æ•°æ®é¢„è§ˆï¼ˆå‰3è¡Œï¼‰
                        <div class="keyboard-shortcuts">æç¤ºï¼šåŒå‡»è¡¨å¤´å¯ç¼–è¾‘åˆ—å</div>
                    </div>
                    <div style="overflow-x: auto;">
                        <table class="preview-table" id="previewTable">
                            <thead id="previewTableHead"></thead>
                            <tbody id="previewTableBody"></tbody>
                        </table>
                    </div>
                    <div style="margin-top: 15px; text-align: center;">
                        <button class="btn btn-primary" onclick="proceedToConfig()">âœ… ç»§ç»­é…ç½®</button>
                    </div>
                </div>
                
                <div id="annotationConfigSection" style="display:none;" class="form-section">
                    <div class="section-title">é…ç½®æ•°æ®åˆ—å’Œæ ‡æ³¨é¡¹</div>
                    <div class="annotation-configs" id="annotationConfigs"></div>
                    <div style="margin-top: 20px; text-align: center;">
                        <button class="btn btn-outline" onclick="addAnnotationConfig()">â• æ·»åŠ æ ‡æ³¨é¡¹</button>
                        <button class="btn btn-success" onclick="saveAnnotationConfig()" style="margin-left: 15px;">ğŸ’¾ ä¿å­˜é…ç½®å¹¶å¼€å§‹æ ‡æ³¨</button>
                    </div>
                </div>
            </div>
            
            <!-- æ•°æ®æ ‡æ³¨é¡µé¢ -->
            <div id="annotate" class="tab-content">
                <div class="toolbar">
                    <div class="toolbar-group">
                        <label class="form-label">æ¯é¡µæ˜¾ç¤ºï¼š</label>
                        <select class="form-control" id="pageSize" onchange="changePageSize()" style="width: 80px;">
                            <option value="10">10</option>
                            <option value="20" selected>20</option>
                            <option value="50">50</option>
                            <option value="100">100</option>
                        </select>
                        <span>æ¡</span>
                    </div>
                    
                    <div class="toolbar-group">
                        <span id="paginationInfo">ç¬¬ 1 é¡µï¼Œå…± 1 é¡µ</span>
                        <button class="btn btn-outline" onclick="previousPage()">ä¸Šä¸€é¡µ</button>
                        <button class="btn btn-outline" onclick="nextPage()">ä¸‹ä¸€é¡µ</button>
                    </div>
                    
                    <div class="toolbar-group">
                        <button class="btn btn-outline" onclick="toggleColumnsModal()">æ˜¾ç¤ºåˆ—è®¾ç½®</button>
                        <button class="btn btn-outline" onclick="batchAnnotate()">æ‰¹é‡æ ‡æ³¨</button>
                        <div class="keyboard-shortcuts">å¿«æ·é”®: Ctrl+S ä¿å­˜</div>
                    </div>
                </div>
                
                <div class="data-table-container">
                    <div class="table-wrapper">
                        <table class="data-table" id="dataTable">
                            <thead id="dataTableHead"></thead>
                            <tbody id="dataTableBody"></tbody>
                        </table>
                    </div>
                </div>
                
                <div class="toolbar" style="justify-content: center;">
                    <button class="btn btn-primary" onclick="exportAnnotations()">å¯¼å‡ºå½“å‰é¡µ</button>
                    <button class="btn btn-success" onclick="switchTab('export', this)">æŸ¥çœ‹å®Œæ•´ç»Ÿè®¡</button>
                </div>
            </div>
            
            <!-- å¯¼å‡ºåˆ†æé¡µé¢ -->
            <div id="export" class="tab-content">
                <div class="stats-grid" id="statsGrid"></div>
                
                <div class="form-section">
                    <div class="section-title">å¯¼å‡ºè®¾ç½®</div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">å¯¼å‡ºæ ¼å¼ï¼š</label>
                            <select class="form-control" id="exportFormat">
                                <option value="csv">CSV</option>
                                <option value="excel">Excel (XLSX)</option>
                                <option value="json">JSON</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="checkbox-group">
                            <input type="checkbox" id="includeOriginal" checked>
                            <label for="includeOriginal">åŒ…å«åŸå§‹æ•°æ®</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="includeAnnotations" checked>
                            <label for="includeAnnotations">åŒ…å«æ ‡æ³¨ç»“æœ</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="includeStats">
                            <label for="includeStats">åŒ…å«ç»Ÿè®¡ä¿¡æ¯</label>
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px;">
                        <button class="btn btn-success" onclick="exportData()">ğŸ“¥ å¯¼å‡ºæ•°æ®</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- åˆ›å»ºé¡¹ç›®æ¨¡æ€æ¡† -->
    <div id="createProjectModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>åˆ›å»ºæ–°é¡¹ç›®</h3>
                <button class="close-modal" onclick="closeModal('createProjectModal')">&times;</button>
            </div>
            <div class="form-group">
                <label class="form-label">é¡¹ç›®åç§°ï¼š</label>
                <input type="text" class="form-control" id="projectName" placeholder="è¯·è¾“å…¥é¡¹ç›®åç§°">
            </div>
            <div class="form-group">
                <label class="form-label">é¡¹ç›®æè¿°ï¼š</label>
                <textarea class="form-control" id="projectDescription" rows="3" placeholder="è¯·è¾“å…¥é¡¹ç›®æè¿°"></textarea>
            </div>
            <div style="margin-top: 20px; text-align: right;">
                <button class="btn btn-secondary" onclick="closeModal('createProjectModal')">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="createProject()" style="margin-left: 10px;">åˆ›å»º</button>
            </div>
        </div>
    </div>
    
    <!-- æœç´¢ç»“æœæ¨¡æ€æ¡† -->
    <div id="searchModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>æœç´¢ç»“æœ</h3>
                <button class="close-modal" onclick="closeModal('searchModal')">&times;</button>
            </div>
            <div id="searchResults"></div>
        </div>
    </div>
    
    <!-- è‡ªåŠ¨ä¿å­˜æŒ‡ç¤ºå™¨ -->
    <div id="autosaveIndicator" class="autosave-indicator">
        è‡ªåŠ¨ä¿å­˜å·²å¼€å¯
    </div>
    
    <script>
        // å…¨å±€å˜é‡
        const API_BASE = 'http://localhost:5000';  // APIåŸºç¡€è·¯å¾„ï¼Œæ ¹æ®å®é™…éƒ¨ç½²ä¿®æ”¹
        let currentProject = null;
        let currentPage = 1;
        let pageSize = 20;
        let totalPages = 1;
        let annotationConfigs = [];
        let columnConfigs = [];
        let previewData = [];
        let autosaveInterval = null;
        let allProjects = []; // å­˜å‚¨æ‰€æœ‰é¡¹ç›®æ•°æ®ç”¨äºæœç´¢å’Œæ’åº
        let deleteProjectId = null; // å¾…åˆ é™¤çš„é¡¹ç›®ID
        
        // å·¥å…·å‡½æ•°
        function showLoading(text = 'å¤„ç†ä¸­...') {
            document.getElementById('loadingText').textContent = text;
            document.getElementById('loadingOverlay').classList.add('show');
        }
        
        function hideLoading() {
            document.getElementById('loadingOverlay').classList.remove('show');
        }
        
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast ${type} show`;
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }
        
        function updateBreadcrumb(path) {
            const breadcrumb = document.getElementById('breadcrumb');
            breadcrumb.innerHTML = path;
        }
        
        function updatePageTitle(title, subtitle = '') {
            document.getElementById('pageTitle').textContent = title;
            document.getElementById('pageSubtitle').textContent = subtitle;
        }
        
        function updateWizardStep(step) {
            for (let i = 1; i <= 4; i++) {
                const stepEl = document.getElementById(`step${i}`);
                if (stepEl) {
                    stepEl.classList.remove('active', 'completed');
                    if (i < step) {
                        stepEl.classList.add('completed');
                    } else if (i === step) {
                        stepEl.classList.add('active');
                    }
                }
            }
        }
        
        // é¡µé¢åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            loadProjects();
            startAutoSave();
            showAutosaveIndicator();
            
            // é”®ç›˜å¿«æ·é”®
            document.addEventListener('keydown', function(e) {
                if (e.ctrlKey && e.key === 's') {
                    e.preventDefault();
                    if (currentProject) {
                        showToast('æ•°æ®å·²è‡ªåŠ¨ä¿å­˜');
                    }
                }
            });
        });
        
        // é¡¹ç›®ç®¡ç†åŠŸèƒ½
        function loadProjects() {
            showLoading('åŠ è½½é¡¹ç›®åˆ—è¡¨...');
            
            fetch(`${API_BASE}/api/projects`)
                .then(response => response.json())
                .then(projects => {
                    allProjects = projects;
                    displayProjects(projects);
                    updateProjectCount(projects.length);
                    hideLoading();
                })
                .catch(error => {
                    console.error('åŠ è½½é¡¹ç›®å¤±è´¥:', error);
                    showToast('åŠ è½½é¡¹ç›®å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥', 'error');
                    hideLoading();
                });
        }
        
        function displayProjects(projects) {
            const grid = document.getElementById('projectGrid');
            const createCard = grid.querySelector('.create-project-card');
            grid.innerHTML = '';
            grid.appendChild(createCard);
            
            projects.forEach(project => {
                const projectCard = createProjectCard(project);
                grid.appendChild(projectCard);
            });
        }
        
        function createProjectCard(project) {
            const div = document.createElement('div');
            div.className = 'project-card';
            div.onclick = () => openProject(project.id);
            
            div.innerHTML = `
                <div class="project-card-actions">
                    <button class="action-btn edit" onclick="event.stopPropagation(); editProject('${project.id}')" title="ç¼–è¾‘é¡¹ç›®">
                        âœ
                    </button>
                    <button class="action-btn delete" onclick="event.stopPropagation(); showDeleteProject('${project.id}', '${project.name}')" title="åˆ é™¤é¡¹ç›®">
                        âœ—
                    </button>
                </div>
                <div class="project-title">${project.name}</div>
                <div class="project-description">${project.description || 'æš‚æ— æè¿°'}</div>
                <div class="project-stats">
                    <span>æ•°æ®é‡: ${project.data_count}</span>
                    <div class="project-progress">
                        <span>${project.completion_rate}%</span>
                        <div class="progress-bar-small">
                            <div class="progress-fill-small" style="width: ${project.completion_rate}%"></div>
                        </div>
                    </div>
                </div>
                <div style="font-size: 12px; color: #6c757d; margin-top: 10px;">
                    æœ€åæ›´æ–°: ${new Date(project.updated_at).toLocaleString()}
                </div>
            `;
            
            return div;
        }
        
        function searchProjects() {
            const searchTerm = document.getElementById('projectSearch').value.toLowerCase();
            const filtered = allProjects.filter(project => 
                project.name.toLowerCase().includes(searchTerm) ||
                (project.description && project.description.toLowerCase().includes(searchTerm))
            );
            displayProjects(filtered);
            updateProjectCount(filtered.length);
        }
        
        function sortProjects() {
            const sortBy = document.getElementById('projectSort').value;
            let sorted = [...allProjects];
            
            switch(sortBy) {
                case 'name_asc':
                    sorted.sort((a, b) => a.name.localeCompare(b.name));
                    break;
                case 'created_desc':
                    sorted.sort((a, b) => new Date(b.created_at) - new Date(a.created_at));
                    break;
                case 'progress_desc':
                    sorted.sort((a, b) => b.completion_rate - a.completion_rate);
                    break;
                case 'updated_desc':
                default:
                    sorted.sort((a, b) => new Date(b.updated_at) - new Date(a.updated_at));
                    break;
            }
            
            allProjects = sorted;
            searchProjects(); // åº”ç”¨å½“å‰æœç´¢æ¡ä»¶
        }
        
        function updateProjectCount(count) {
            document.getElementById('projectCount').textContent = count;
        }
        
        function showDeleteProject(projectId, projectName) {
            deleteProjectId = projectId;
            document.getElementById('deleteProjectName').textContent = projectName;
            document.getElementById('deleteProjectModal').classList.add('active');
        }
        
        // æ˜¾ç¤ºè‡ªåŠ¨ä¿å­˜æŒ‡ç¤ºå™¨
        function showAutosaveIndicator() {
            const indicator = document.getElementById('autosaveIndicator');
            indicator.style.display = 'block';
            setTimeout(() => indicator.style.display = 'none', 3000);
        }
        
        // å¼€å§‹è‡ªåŠ¨ä¿å­˜
        function startAutoSave() {
            if (autosaveInterval) clearInterval(autosaveInterval);
            autosaveInterval = setInterval(() => {
                if (currentProject) {
                    const indicator = document.getElementById('autosaveIndicator');
                    indicator.textContent = 'æ­£åœ¨è‡ªåŠ¨ä¿å­˜...';
                    indicator.style.background = '#ffc107';
                    indicator.style.color = '#333';
                    indicator.style.display = 'block';
                    
                    setTimeout(() => {
                        indicator.textContent = 'è‡ªåŠ¨ä¿å­˜å®Œæˆ';
                        indicator.style.background = '#28a745';
                        indicator.style.color = 'white';
                        setTimeout(() => indicator.style.display = 'none', 2000);
                    }, 1000);
                }
            }, 30000);
        }
        
        // åˆ‡æ¢æ ‡ç­¾é¡µ
        function switchTab(tabName, element = null) {
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            const targetTab = element || document.querySelector(`[onclick*="'${tabName}'"]`);
            if (targetTab) {
                targetTab.classList.add('active');
            }
            
            document.getElementById(tabName).classList.add('active');
            
            if (tabName === 'export') {
                loadStatistics();
            }
        }
        
        // åŠ è½½é¡¹ç›®åˆ—è¡¨
        async function loadProjects() {
            try {
                const response = await fetch(`${API_BASE}/api/projects`);
                const projects = await response.json();
                
                const grid = document.getElementById('projectGrid');
                const createCard = grid.querySelector('.create-project-card');
                grid.innerHTML = '';
                grid.appendChild(createCard);
                
                projects.forEach(project => {
                    const projectCard = createProjectCard(project);
                    grid.appendChild(projectCard);
                });
            } catch (error) {
                console.error('åŠ è½½é¡¹ç›®å¤±è´¥:', error);
                showToast('åŠ è½½é¡¹ç›®å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥', 'error');
            }
        }
        
        // ä¸Šä¼ æ•°æ® - å¢å¼ºç‰ˆæœ¬
        async function uploadData() {
            if (!currentProject) {
                showToast('è¯·å…ˆé€‰æ‹©é¡¹ç›®', 'warning');
                return;
            }
            
            updateWizardStep(1);
            showLoading('ä¸Šä¼ æ–‡ä»¶ä¸­...');
            
            const formData = new FormData();
            const uploadType = document.getElementById('uploadType').value;
            
            formData.append('upload_type', uploadType);
            formData.append('delimiter', document.getElementById('delimiter').value === 'custom' 
                ? document.getElementById('customDelimiter').value 
                : document.getElementById('delimiter').value);
            formData.append('encoding', document.getElementById('encoding').value);
            formData.append('has_header', document.getElementById('hasHeader').checked);
            
            if (uploadType === 'file') {
                const file = document.getElementById('dataFile').files[0];
                if (!file) {
                    hideLoading();
                    showToast('è¯·é€‰æ‹©æ–‡ä»¶', 'warning');
                    return;
                }
                formData.append('file', file);
            } else if (uploadType === 'url') {
                formData.append('url', document.getElementById('dataUrl').value);
            } else if (uploadType === 'ftp') {
                formData.append('ftp_server', document.getElementById('ftpServer').value);
                formData.append('ftp_user', document.getElementById('ftpUser').value);
                formData.append('ftp_password', document.getElementById('ftpPassword').value);
                formData.append('ftp_path', document.getElementById('ftpPath').value);
            }
            
            try {
                const response = await fetch(`${API_BASE}/api/projects/${currentProject.id}/upload`, {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                hideLoading();
                
                if (response.ok) {
                    previewData = result.preview_data;
                    displayPreviewData(result.headers, result.preview_data);
                    updateWizardStep(2);
                    showToast(`ä¸Šä¼ æˆåŠŸï¼å…±è§£æ ${result.total_rows} è¡Œæ•°æ®`);
                    
                    // æ˜¾ç¤ºæ›¿æ¢æ–‡ä»¶æŒ‰é’®
                    document.getElementById('replaceFileBtn').style.display = 'block';
                } else {
                    showToast(result.error || 'ä¸Šä¼ å¤±è´¥', 'error');
                }
            } catch (error) {
                hideLoading();
                console.error('ä¸Šä¼ å¤±è´¥:', error);
                showToast('ä¸Šä¼ å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥', 'error');
            }
        }
        
        // ä¿å­˜æ ‡æ³¨é…ç½® - å¢å¼ºç‰ˆæœ¬
        async function saveAnnotationConfig() {
            if (!currentProject) {
                showToast('è¯·å…ˆé€‰æ‹©é¡¹ç›®', 'warning');
                return;
            }
            
            updateWizardStep(3);
            showLoading('ä¿å­˜é…ç½®ä¸­...');
            
            try {
                const headers = Object.keys(previewData[0] || {});
                const columnConfigs = headers.map((header, index) => ({
                    original_name: header,
                    display_name: header,
                    is_visible: document.getElementById(`visible_${index}`)?.checked || true,
                    is_url: document.getElementById(`isUrl_${index}`)?.checked || false,
                    url_new_window: document.getElementById(`urlNewWindow_${index}`)?.checked || true,
                    column_width: parseInt(document.getElementById(`width_${index}`)?.value) || 150,
                    is_searchable: document.getElementById(`searchable_${index}`)?.checked || false,
                    search_api: document.getElementById(`searchApi_${index}`)?.querySelector('input')?.value || ''
                }));
                
                const annotationConfigsList = [];
                for (const configId of annotationConfigs) {
                    const fieldName = document.getElementById(`${configId}_fieldName`)?.value.trim();
                    if (!fieldName) {
                        hideLoading();
                        showToast('è¯·å¡«å†™æ‰€æœ‰æ ‡æ³¨é¡¹çš„å­—æ®µåç§°', 'warning');
                        return;
                    }
                    
                    const config = {
                        fieldName,
                        labelText: document.getElementById(`${configId}_labelText`)?.value || '',
                        inputType: document.getElementById(`${configId}_inputType`)?.value || 'text',
                        minValue: document.getElementById(`${configId}_minValue`)?.value || '',
                        maxValue: document.getElementById(`${configId}_maxValue`)?.value || '',
                        options: document.getElementById(`${configId}_options`)?.value.split('\n').filter(opt => opt.trim()) || [],
                        isSearchable: document.getElementById(`${configId}_isSearchable`)?.checked || false,
                        searchApi: document.getElementById(`${configId}_searchApi`)?.value || ''
                    };
                    
                    annotationConfigsList.push(config);
                }
                
                const columnResponse = await fetch(`${API_BASE}/api/projects/${currentProject.id}/columns`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ columns: columnConfigs })
                });
                
                if (!columnResponse.ok) {
                    const error = await columnResponse.json();
                    throw new Error(error.message || 'åˆ—é…ç½®ä¿å­˜å¤±è´¥');
                }
                
                const configResponse = await fetch(`${API_BASE}/api/projects/${currentProject.id}/config`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        annotation_configs: annotationConfigsList,
                        column_configs: columnConfigs
                    })
                });
                
                if (!configResponse.ok) {
                    const error = await configResponse.json();
                    throw new Error(error.message || 'æ ‡æ³¨é…ç½®ä¿å­˜å¤±è´¥');
                }
                
                hideLoading();
                updateWizardStep(4);
                showToast('é…ç½®ä¿å­˜æˆåŠŸ');
                switchTab('annotate');
                loadAnnotationData();
                
            } catch (error) {
                hideLoading();
                console.error('ä¿å­˜é…ç½®å¤±è´¥:', error);
                showToast(`ä¿å­˜é…ç½®å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        // å…³é—­æ¨¡æ€æ¡†
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }
        
        // ç‚¹å‡»æ¨¡æ€æ¡†èƒŒæ™¯å…³é—­
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', function(e) {
                if (e.target === this) {
                    this.classList.remove('active');
                }
            });
        });
        
        // å¯¼èˆªåŠŸèƒ½
        function backToProjects() {
            currentProject = null;
            
            // éšè—é¡¹ç›®ç›¸å…³æ ‡ç­¾
            document.getElementById('uploadTab').style.display = 'none';
            document.getElementById('annotateTab').style.display = 'none';
            document.getElementById('exportTab').style.display = 'none';
            
            // é‡ç½®é¡µé¢æ ‡é¢˜å’Œé¢åŒ…å±‘
            updatePageTitle('æ™ºèƒ½æ•°æ®æ ‡æ³¨å¹³å°', 'åŸºäºé¡¹ç›®ç®¡ç†çš„é«˜æ•ˆæ•°æ®æ ‡æ³¨è§£å†³æ–¹æ¡ˆ');
            updateBreadcrumb('<a href="#" onclick="backToProjects()">é¡¹ç›®ç®¡ç†</a>');
            
            // åˆ‡æ¢åˆ°é¡¹ç›®é¡µé¢
            switchTab('projects');
            
            // é‡æ–°åŠ è½½é¡¹ç›®åˆ—è¡¨
            loadProjects();
        }
        
        // æ–‡ä»¶ä¸Šä¼ å¢å¼ºåŠŸèƒ½
        function handleDragOver(e) {
            e.preventDefault();
            document.getElementById('uploadArea').classList.add('dragover');
        }
        
        function handleDragLeave(e) {
            e.preventDefault();
            document.getElementById('uploadArea').classList.remove('dragover');
        }
        
        function handleFileDrop(e) {
            e.preventDefault();
            const uploadArea = document.getElementById('uploadArea');
            uploadArea.classList.remove('dragover');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                const file = files[0];
                if (isValidFile(file)) {
                    document.getElementById('dataFile').files = files;
                    displayFileInfo(file);
                } else {
                    showToast('è¯·é€‰æ‹©æœ‰æ•ˆçš„æ–‡ä»¶æ ¼å¼ (CSV, TSV, TXT)', 'error');
                }
            }
        }
        
        function handleFileSelect(e) {
            const file = e.target.files[0];
            if (file) {
                displayFileInfo(file);
            }
        }
        
        function isValidFile(file) {
            const validExtensions = ['csv', 'tsv', 'txt'];
            const fileExtension = file.name.split('.').pop().toLowerCase();
            return validExtensions.includes(fileExtension);
        }
        
        function displayFileInfo(file) {
            const uploadArea = document.getElementById('uploadArea');
            const fileInfo = document.getElementById('fileInfo');
            
            uploadArea.classList.add('has-file');
            document.getElementById('uploadIcon').textContent = 'ğŸ“„';
            document.getElementById('uploadTitle').textContent = 'æ–‡ä»¶å·²é€‰æ‹©';
            document.getElementById('uploadSubtitle').textContent = 'ç‚¹å‡»"ä¸Šä¼ å¹¶è§£æ"å¼€å§‹å¤„ç†';
            
            // æ˜¾ç¤ºæ–‡ä»¶ä¿¡æ¯
            document.getElementById('fileName').textContent = file.name;
            document.getElementById('fileSize').textContent = formatFileSize(file.size);
            document.getElementById('fileDate').textContent = new Date(file.lastModified).toLocaleString();
            fileInfo.style.display = 'block';
            
            // å¯ç”¨ä¸Šä¼ æŒ‰é’®
            document.getElementById('uploadBtn').disabled = false;
        }
        
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        function testUrl() {
            const url = document.getElementById('dataUrl').value;
            if (!url) {
                showToast('è¯·è¾“å…¥URLåœ°å€', 'warning');
                return;
            }
            
            showLoading('æµ‹è¯•è¿æ¥ä¸­...');
            
            fetch(url, { method: 'HEAD' })
                .then(response => {
                    hideLoading();
                    if (response.ok) {
                        showToast('è¿æ¥æµ‹è¯•æˆåŠŸ');
                    } else {
                        showToast('è¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥URLæ˜¯å¦æ­£ç¡®', 'error');
                    }
                })
                .catch(error => {
                    hideLoading();
                    showToast('è¿æ¥æµ‹è¯•å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ–URL', 'error');
                });
        }
        
        function testFtpConnection() {
            const server = document.getElementById('ftpServer').value;
            const user = document.getElementById('ftpUser').value;
            
            if (!server || !user) {
                showToast('è¯·å¡«å†™FTPæœåŠ¡å™¨å’Œç”¨æˆ·å', 'warning');
                return;
            }
            
            showToast('FTPè¿æ¥æµ‹è¯•åŠŸèƒ½éœ€è¦åç«¯æ”¯æŒ', 'warning');
        }
        
        // é…ç½®å‘å¯¼åŠŸèƒ½
        function proceedToConfig() {
            updateWizardStep(3);
            
            // æ»šåŠ¨åˆ°é…ç½®åŒºåŸŸ
            document.getElementById('annotationConfigSection').scrollIntoView({ 
                behavior: 'smooth' 
            });
        }
        
        // æ›¿æ¢æ–‡ä»¶åŠŸèƒ½
        function showReplaceFileModal() {
            if (!currentProject) {
                showToast('è¯·å…ˆé€‰æ‹©é¡¹ç›®', 'warning');
                return;
            }
            document.getElementById('replaceFileModal').classList.add('active');
        }
        
        function confirmReplaceFile() {
            const file = document.getElementById('replaceDataFile').files[0];
            if (!file) {
                showToast('è¯·é€‰æ‹©è¦æ›¿æ¢çš„æ–‡ä»¶', 'warning');
                return;
            }
            
            if (!isValidFile(file)) {
                showToast('è¯·é€‰æ‹©æœ‰æ•ˆçš„æ–‡ä»¶æ ¼å¼', 'error');
                return;
            }
            
            showLoading('æ›¿æ¢æ–‡ä»¶ä¸­...');
            
            const formData = new FormData();
            formData.append('upload_type', 'file');
            formData.append('file', file);
            formData.append('delimiter', document.getElementById('delimiter').value);
            formData.append('encoding', document.getElementById('encoding').value);
            formData.append('has_header', document.getElementById('hasHeader').checked);
            
            fetch(`${API_BASE}/api/projects/${currentProject.id}/replace-file`, {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(result => {
                hideLoading();
                if (result.message) {
                    showToast(`æ–‡ä»¶æ›¿æ¢æˆåŠŸ! ä¿ç•™äº†${result.configs_preserved}ä¸ªåˆ—é…ç½®`);
                    closeModal('replaceFileModal');
                    
                    // æ›´æ–°é¢„è§ˆæ•°æ®
                    previewData = result.preview_data;
                    displayPreviewData(result.headers, result.preview_data);
                    
                    // åˆ‡æ¢åˆ°æ ‡æ³¨é¡µé¢
                    switchTab('annotate');
                    loadAnnotationData();
                } else {
                    showToast(result.error || 'æ–‡ä»¶æ›¿æ¢å¤±è´¥', 'error');
                }
            })
            .catch(error => {
                hideLoading();
                console.error('æ›¿æ¢æ–‡ä»¶å¤±è´¥:', error);
                showToast('æ›¿æ¢æ–‡ä»¶å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥', 'error');
            });
        }
        
        // åŠ è½½é¡¹ç›®åˆ—è¡¨
        async function loadProjects() {
            try {
                const response = await fetch(`${API_BASE}/api/projects`);
                const projects = await response.json();
                
                const grid = document.getElementById('projectGrid');
                const createCard = grid.querySelector('.create-project-card');
                grid.innerHTML = '';
                grid.appendChild(createCard);
                
                projects.forEach(project => {
                    const projectCard = createProjectCard(project);
                    grid.appendChild(projectCard);
                });
            } catch (error) {
                console.error('åŠ è½½é¡¹ç›®å¤±è´¥:', error);
                alert('åŠ è½½é¡¹ç›®å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥');
            }
        }
        
        // åˆ›å»ºé¡¹ç›®å¡ç‰‡
        function createProjectCard(project) {
            const div = document.createElement('div');
            div.className = 'project-card';
            div.onclick = () => openProject(project.id);
            
            div.innerHTML = `
                <div class="project-title">${project.name}</div>
                <div class="project-description">${project.description || 'æš‚æ— æè¿°'}</div>
                <div class="project-stats">
                    <span>æ•°æ®é‡: ${project.data_count}</span>
                    <div class="project-progress">
                        <span>${project.completion_rate}%</span>
                        <div class="progress-bar-small">
                            <div class="progress-fill-small" style="width: ${project.completion_rate}%"></div>
                        </div>
                    </div>
                </div>
            `;
            
            return div;
        }
        
        // æ˜¾ç¤ºåˆ›å»ºé¡¹ç›®æ¨¡æ€æ¡†
        function showCreateProjectModal() {
            document.getElementById('createProjectModal').classList.add('active');
            document.getElementById('projectName').value = '';
            document.getElementById('projectDescription').value = '';
        }
        
        // åˆ›å»ºé¡¹ç›®
        async function createProject() {
            const name = document.getElementById('projectName').value.trim();
            const description = document.getElementById('projectDescription').value.trim();
            
            if (!name) {
                alert('è¯·è¾“å…¥é¡¹ç›®åç§°');
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/api/projects`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, description })
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    closeModal('createProjectModal');
                    loadProjects();
                    alert('é¡¹ç›®åˆ›å»ºæˆåŠŸ');
                } else {
                    alert(result.error || 'åˆ›å»ºå¤±è´¥');
                }
            } catch (error) {
                console.error('åˆ›å»ºé¡¹ç›®å¤±è´¥:', error);
                alert('åˆ›å»ºé¡¹ç›®å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥');
            }
        }
        
        // æ‰“å¼€é¡¹ç›®
        async function openProject(projectId) {
            try {
                console.log('æ­£åœ¨æ‰“å¼€é¡¹ç›®:', projectId);
                
                const response = await fetch(`${API_BASE}/api/projects/${projectId}`);
                console.log('é¡¹ç›®å“åº”çŠ¶æ€:', response.status);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('é¡¹ç›®åŠ è½½é”™è¯¯:', errorText);
                    throw new Error(`é¡¹ç›®ä¸å­˜åœ¨æˆ–åŠ è½½å¤±è´¥: ${response.status}`);
                }
                
                currentProject = await response.json();
                console.log('åŠ è½½çš„é¡¹ç›®æ•°æ®:', currentProject);
                
                // æ˜¾ç¤ºé¡¹ç›®ç›¸å…³æ ‡ç­¾é¡µ
                document.getElementById('uploadTab').style.display = 'block';
                document.getElementById('annotateTab').style.display = 'block';
                document.getElementById('exportTab').style.display = 'block';
                
                // æ›´æ–°é¡µé¢æ ‡é¢˜
                document.querySelector('.header h1').textContent = `ğŸ¯ ${currentProject.name}`;
                
                // æ£€æŸ¥æ˜¯å¦å·²æœ‰æ•°æ®
                const dataResponse = await fetch(`${API_BASE}/api/projects/${projectId}/data?page=1&per_page=1`);
                if (dataResponse.ok) {
                    const dataResult = await dataResponse.json();
                    console.log('æ•°æ®æ£€æŸ¥ç»“æœ:', dataResult);
                    
                    if (dataResult.data && dataResult.data.length > 0) {
                        console.log('é¡¹ç›®å·²æœ‰æ•°æ®ï¼Œåˆ‡æ¢åˆ°æ ‡æ³¨é¡µé¢');
                        switchTab('annotate');
                        loadAnnotationData();
                    } else {
                        console.log('é¡¹ç›®æ— æ•°æ®ï¼Œåˆ‡æ¢åˆ°ä¸Šä¼ é¡µé¢');
                        switchTab('upload');
                    }
                } else {
                    console.log('æ— æ³•æ£€æŸ¥é¡¹ç›®æ•°æ®ï¼Œåˆ‡æ¢åˆ°ä¸Šä¼ é¡µé¢');
                    switchTab('upload');
                }
                
            } catch (error) {
                console.error('æ‰“å¼€é¡¹ç›®è¯¦ç»†é”™è¯¯:', error);
                alert(`æ‰“å¼€é¡¹ç›®å¤±è´¥: ${error.message}`);
            }
        }
        
        // åˆ‡æ¢ä¸Šä¼ æ–¹å¼
        function toggleUploadMethod() {
            const type = document.getElementById('uploadType').value;
            document.getElementById('fileUpload').style.display = type === 'file' ? 'block' : 'none';
            document.getElementById('urlUpload').style.display = type === 'url' ? 'block' : 'none';
            document.getElementById('ftpUpload').style.display = type === 'ftp' ? 'block' : 'none';
        }
        
        // åˆ‡æ¢è‡ªå®šä¹‰åˆ†éš”ç¬¦
        function toggleCustomDelimiter() {
            const delimiter = document.getElementById('delimiter').value;
            document.getElementById('customDelimiterGroup').style.display = 
                delimiter === 'custom' ? 'block' : 'none';
        }
        
        // ä¸Šä¼ æ•°æ®
        async function uploadData() {
            if (!currentProject) {
                alert('è¯·å…ˆé€‰æ‹©é¡¹ç›®');
                return;
            }
            
            const formData = new FormData();
            const uploadType = document.getElementById('uploadType').value;
            
            formData.append('upload_type', uploadType);
            formData.append('delimiter', document.getElementById('delimiter').value === 'custom' 
                ? document.getElementById('customDelimiter').value 
                : document.getElementById('delimiter').value);
            formData.append('encoding', document.getElementById('encoding').value);
            formData.append('has_header', document.getElementById('hasHeader').checked);
            
            if (uploadType === 'file') {
                const file = document.getElementById('dataFile').files[0];
                if (!file) {
                    alert('è¯·é€‰æ‹©æ–‡ä»¶');
                    return;
                }
                formData.append('file', file);
            } else if (uploadType === 'url') {
                formData.append('url', document.getElementById('dataUrl').value);
            } else if (uploadType === 'ftp') {
                formData.append('ftp_server', document.getElementById('ftpServer').value);
                formData.append('ftp_user', document.getElementById('ftpUser').value);
                formData.append('ftp_password', document.getElementById('ftpPassword').value);
                formData.append('ftp_path', document.getElementById('ftpPath').value);
            }
            
            try {
                const response = await fetch(`${API_BASE}/api/projects/${currentProject.id}/upload`, {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    previewData = result.preview_data;
                    displayPreviewData(result.headers, result.preview_data);
                    showAnnotationConfigSection(result.headers);
                    alert(`ä¸Šä¼ æˆåŠŸï¼å…±è§£æ ${result.total_rows} è¡Œæ•°æ®`);
                } else {
                    alert(result.error || 'ä¸Šä¼ å¤±è´¥');
                }
            } catch (error) {
                console.error('ä¸Šä¼ å¤±è´¥:', error);
                alert('ä¸Šä¼ å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥');
            }
        }
        
        // æ˜¾ç¤ºé¢„è§ˆæ•°æ®å’Œåˆ—é…ç½®
        function displayPreviewData(headers, data) {
            const previewSection = document.getElementById('previewSection');
            const tableHead = document.getElementById('previewTableHead');
            const tableBody = document.getElementById('previewTableBody');
            
            previewSection.style.display = 'block';
            
            // æ„å»ºè¡¨å¤´
            tableHead.innerHTML = `
                <tr>
                    ${headers.map(header => `
                        <th>
                            <input type="text" class="editable-header" value="${header}" 
                                   onchange="updateHeader(this, '${header}')">
                        </th>
                    `).join('')}
                </tr>
            `;
            
            // æ„å»ºæ•°æ®è¡Œ
            tableBody.innerHTML = data.map(row => `
                <tr>
                    ${headers.map(header => `<td>${row[header] || ''}</td>`).join('')}
                </tr>
            `).join('');
            
            // æ˜¾ç¤ºåˆ—é…ç½®åŒºåŸŸ
            showColumnConfigSection(headers);
        }
        
        // æ˜¾ç¤ºåˆ—é…ç½®åŒºåŸŸ
        function showColumnConfigSection(headers) {
            const configSection = document.getElementById('annotationConfigSection');
            const configsContainer = document.getElementById('annotationConfigs');
            
            // å…ˆæ˜¾ç¤ºåˆ—é…ç½®
            configsContainer.innerHTML = `
                <div class="annotation-config-card">
                    <div class="config-header">
                        <div class="config-title">åŸå§‹æ•°æ®åˆ—é…ç½®</div>
                    </div>
                    <div class="section-title" style="font-size: 16px; margin-bottom: 15px;">é…ç½®åŸå§‹æ•°æ®åˆ—çš„æ˜¾ç¤ºå’Œè¡Œä¸º</div>
                    <div id="columnConfigList">
                        ${headers.map((header, index) => `
                            <div class="form-row" style="align-items: center; padding: 15px; border: 1px solid #e9ecef; border-radius: 8px; margin-bottom: 15px; background: #fafafa;">
                                <div class="form-group" style="margin: 0; flex: 2;">
                                    <label class="form-label" style="font-weight: 600; color: #495057;">åˆ—å: ${header}</label>
                                </div>
                                <div class="form-group" style="margin: 0; flex: 1;">
                                    <label class="form-label">åˆ—å®½åº¦ (px):</label>
                                    <input type="number" class="form-control column-width-input" id="width_${index}" 
                                           value="150" min="50" max="500" placeholder="150">
                                </div>
                                <div class="checkbox-group">
                                    <input type="checkbox" id="visible_${index}" checked>
                                    <label for="visible_${index}">æ˜¾ç¤º</label>
                                </div>
                                <div class="checkbox-group">
                                    <input type="checkbox" id="isUrl_${index}" onchange="toggleUrlOptions(${index})">
                                    <label for="isUrl_${index}">URLé“¾æ¥</label>
                                </div>
                                <div class="checkbox-group" id="urlOptions_${index}" style="display: none;">
                                    <input type="checkbox" id="urlNewWindow_${index}" checked>
                                    <label for="urlNewWindow_${index}">å°çª—å£æ‰“å¼€</label>
                                </div>
                                <div class="checkbox-group">
                                    <input type="checkbox" id="searchable_${index}" onchange="toggleColumnSearch(${index})">
                                    <label for="searchable_${index}">å¯ç”¨æœç´¢</label>
                                </div>
                                <div class="form-group" id="searchApi_${index}" style="display: none; margin-top: 10px; flex: 2;">
                                    <label class="form-label">æœç´¢API:</label>
                                    <input type="text" class="form-control" placeholder="https://api.example.com/search">
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            
            // ç„¶åæ·»åŠ æ ‡æ³¨é¡¹é…ç½®åŒºåŸŸ
            configsContainer.innerHTML += `
                <div class="annotation-config-card">
                    <div class="config-header">
                        <div class="config-title">æ ‡æ³¨é¡¹é…ç½®</div>
                        <button class="btn btn-outline" onclick="addAnnotationConfig()">â• æ·»åŠ æ ‡æ³¨é¡¹</button>
                    </div>
                    <div id="annotationConfigList"></div>
                </div>
            `;
            
            configSection.style.display = 'block';
            
            // é»˜è®¤æ·»åŠ ä¸€ä¸ªæ ‡æ³¨é…ç½®
            if (annotationConfigs.length === 0) {
                addAnnotationConfig();
            }
        }
        
        // åˆ‡æ¢URLé€‰é¡¹
        function toggleUrlOptions(index) {
            const urlOptions = document.getElementById(`urlOptions_${index}`);
            const isUrl = document.getElementById(`isUrl_${index}`).checked;
            urlOptions.style.display = isUrl ? 'block' : 'none';
        }
        
        // æ›´æ–°è¡¨å¤´
        function updateHeader(input, originalHeader) {
            const newHeader = input.value.trim();
            if (!newHeader) {
                alert('è¡¨å¤´ä¸èƒ½ä¸ºç©º');
                input.value = originalHeader;
                return;
            }
            
            // æ›´æ–°é¢„è§ˆæ•°æ®ä¸­çš„è¡¨å¤´
            previewData.forEach(row => {
                if (row[originalHeader] !== undefined) {
                    row[newHeader] = row[originalHeader];
                    if (newHeader !== originalHeader) {
                        delete row[originalHeader];
                    }
                }
            });
            
            // é‡æ–°æ˜¾ç¤ºé¢„è§ˆæ•°æ®
            const headers = Object.keys(previewData[0] || {});
            displayPreviewData(headers, previewData);
        }
        
        // æ˜¾ç¤ºæ ‡æ³¨é…ç½®åŒºåŸŸ
        function showAnnotationConfigSection(headers) {
            const section = document.getElementById('annotationConfigSection');
            section.style.display = 'block';
            
            // é»˜è®¤æ·»åŠ ä¸€ä¸ªæ ‡æ³¨é…ç½®
            if (annotationConfigs.length === 0) {
                addAnnotationConfig();
            }
        }
        
        // æ·»åŠ æ ‡æ³¨é…ç½®
        function addAnnotationConfig() {
            const configId = `config_${Date.now()}`;
            const configList = document.getElementById('annotationConfigList');
            
            const configDiv = document.createElement('div');
            configDiv.className = 'annotation-config-card';
            configDiv.id = configId;
            configDiv.style.marginTop = '15px';
            configDiv.style.padding = '15px';
            configDiv.style.border = '1px solid #e9ecef';
            configDiv.style.borderRadius = '8px';
            
            configDiv.innerHTML = `
                <div class="config-header">
                    <div class="config-title">æ ‡æ³¨é¡¹ #${annotationConfigs.length + 1}</div>
                    <button class="btn btn-danger" onclick="removeAnnotationConfig('${configId}')" style="padding: 5px 10px; font-size: 12px;">åˆ é™¤</button>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">å­—æ®µåç§°ï¼š</label>
                        <input type="text" class="form-control" id="${configId}_fieldName" placeholder="ä¾‹å¦‚ï¼šè´¨é‡è¯„åˆ†">
                    </div>
                    <div class="form-group">
                        <label class="form-label">æ ‡æ³¨æç¤ºï¼š</label>
                        <input type="text" class="form-control" id="${configId}_labelText" placeholder="æ˜¾ç¤ºåœ¨è¾“å…¥æ¡†ä¸Šæ–¹çš„è¯´æ˜æ–‡å­—">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">è¾“å…¥ç±»å‹ï¼š</label>
                        <select class="form-control" id="${configId}_inputType" onchange="toggleInputTypeOptions('${configId}')">
                            <option value="text">æ–‡æœ¬è¾“å…¥</option>
                            <option value="number">æ•°å­—è¾“å…¥</option>
                            <option value="select">ä¸‹æ‹‰é€‰æ‹©</option>
                        </select>
                    </div>
                    <div class="form-group" id="${configId}_numberOptions" style="display:none;">
                        <label class="form-label">æ•°å€¼èŒƒå›´ï¼š</label>
                        <div style="display: flex; gap: 10px;">
                            <input type="number" class="form-control" id="${configId}_minValue" placeholder="æœ€å°å€¼" style="flex: 1;">
                            <input type="number" class="form-control" id="${configId}_maxValue" placeholder="æœ€å¤§å€¼" style="flex: 1;">
                        </div>
                    </div>
                </div>
                
                <div class="form-group" id="${configId}_selectOptions" style="display:none;">
                    <label class="form-label">é€‰é¡¹è®¾ç½®ï¼ˆæ¯è¡Œä¸€ä¸ªé€‰é¡¹ï¼‰ï¼š</label>
                    <textarea class="form-control" id="${configId}_options" rows="3" placeholder="é€‰é¡¹1\né€‰é¡¹2\né€‰é¡¹3"></textarea>
                </div>
                
                <div class="checkbox-group">
                    <input type="checkbox" id="${configId}_isSearchable" onchange="toggleSearchOptions('${configId}')">
                    <label for="${configId}_isSearchable">å¯ç”¨æœç´¢åŠŸèƒ½</label>
                </div>
                
                <div class="form-group" id="${configId}_searchOptions" style="display:none; margin-top: 10px;">
                    <label class="form-label">æœç´¢APIåœ°å€ï¼š</label>
                    <input type="text" class="form-control" id="${configId}_searchApi" placeholder="https://api.example.com/search">
                </div>
            `;
            
            configList.appendChild(configDiv);
            annotationConfigs.push(configId);
        }
        
        // åˆ é™¤æ ‡æ³¨é…ç½®
        function removeAnnotationConfig(configId) {
            if (annotationConfigs.length <= 1) {
                alert('è‡³å°‘éœ€è¦ä¿ç•™ä¸€ä¸ªæ ‡æ³¨é¡¹');
                return;
            }
            
            document.getElementById(configId).remove();
            annotationConfigs = annotationConfigs.filter(id => id !== configId);
        }
        
        // åˆ‡æ¢è¾“å…¥ç±»å‹é€‰é¡¹
        function toggleInputTypeOptions(configId) {
            const inputType = document.getElementById(`${configId}_inputType`).value;
            document.getElementById(`${configId}_numberOptions`).style.display = 
                inputType === 'number' ? 'block' : 'none';
            document.getElementById(`${configId}_selectOptions`).style.display = 
                inputType === 'select' ? 'block' : 'none';
        }
        
        // åˆ‡æ¢æœç´¢é€‰é¡¹
        function toggleSearchOptions(configId) {
            const isSearchable = document.getElementById(`${configId}_isSearchable`).checked;
            document.getElementById(`${configId}_searchOptions`).style.display = 
                isSearchable ? 'block' : 'none';
        }
        
        // ä¿å­˜æ ‡æ³¨é…ç½®
        async function saveAnnotationConfig() {
            if (!currentProject) {
                alert('è¯·å…ˆé€‰æ‹©é¡¹ç›®');
                return;
            }
            
            try {
                // è·å–åˆ—é…ç½®
                const headers = Object.keys(previewData[0] || {});
                const columnConfigs = headers.map((header, index) => ({
                    original_name: header,
                    display_name: header,
                    is_visible: document.getElementById(`visible_${index}`)?.checked || true,
                    is_url: document.getElementById(`isUrl_${index}`)?.checked || false,
                    url_new_window: document.getElementById(`urlNewWindow_${index}`)?.checked || true,
                    column_width: parseInt(document.getElementById(`width_${index}`)?.value) || 150,
                    is_searchable: document.getElementById(`searchable_${index}`)?.checked || false,
                    search_api: document.getElementById(`searchApi_${index}`)?.querySelector('input')?.value || ''
                }));
                
                // è·å–æ ‡æ³¨é…ç½®
                const annotationConfigsList = [];
                for (const configId of annotationConfigs) {
                    const fieldName = document.getElementById(`${configId}_fieldName`)?.value.trim();
                    if (!fieldName) {
                        alert('è¯·å¡«å†™æ‰€æœ‰æ ‡æ³¨é¡¹çš„å­—æ®µåç§°');
                        return;
                    }
                    
                    const config = {
                        fieldName,
                        labelText: document.getElementById(`${configId}_labelText`)?.value || '',
                        inputType: document.getElementById(`${configId}_inputType`)?.value || 'text',
                        minValue: document.getElementById(`${configId}_minValue`)?.value || '',
                        maxValue: document.getElementById(`${configId}_maxValue`)?.value || '',
                        options: document.getElementById(`${configId}_options`)?.value.split('\n').filter(opt => opt.trim()) || [],
                        isSearchable: document.getElementById(`${configId}_isSearchable`)?.checked || false,
                        searchApi: document.getElementById(`${configId}_searchApi`)?.value || ''
                    };
                    
                    annotationConfigsList.push(config);
                }
                
                console.log('ä¿å­˜é…ç½®:', {
                    column_configs: columnConfigs,
                    annotation_configs: annotationConfigsList
                });
                
                // å…ˆä¿å­˜åˆ—é…ç½®
                const columnResponse = await fetch(`${API_BASE}/api/projects/${currentProject.id}/columns`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ columns: columnConfigs })
                });
                
                if (!columnResponse.ok) {
                    const error = await columnResponse.json();
                    throw new Error(error.message || 'åˆ—é…ç½®ä¿å­˜å¤±è´¥');
                }
                
                // å†ä¿å­˜æ ‡æ³¨é…ç½®
                const configResponse = await fetch(`${API_BASE}/api/projects/${currentProject.id}/config`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        annotation_configs: annotationConfigsList,
                        column_configs: columnConfigs
                    })
                });
                
                if (!configResponse.ok) {
                    const error = await configResponse.json();
                    throw new Error(error.message || 'æ ‡æ³¨é…ç½®ä¿å­˜å¤±è´¥');
                }
                
                alert('é…ç½®ä¿å­˜æˆåŠŸ');
                switchTab('annotate');
                loadAnnotationData();
                
            } catch (error) {
                console.error('ä¿å­˜é…ç½®å¤±è´¥:', error);
                alert(`ä¿å­˜é…ç½®å¤±è´¥: ${error.message}`);
            }
        }
        
        // åŠ è½½æ ‡æ³¨æ•°æ®
        async function loadAnnotationData() {
            if (!currentProject) return;
            
            try {
                const response = await fetch(
                    `${API_BASE}/api/projects/${currentProject.id}/data?page=${currentPage}&per_page=${pageSize}`
                );
                
                const result = await response.json();
                
                if (response.ok) {
                    displayAnnotationTable(result.data, result.columns, result.pagination);
                    updatePaginationInfo(result.pagination);
                } else {
                    alert('åŠ è½½æ•°æ®å¤±è´¥');
                }
            } catch (error) {
                console.error('åŠ è½½æ ‡æ³¨æ•°æ®å¤±è´¥:', error);
                alert('åŠ è½½æ•°æ®å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥');
            }
        }
        
        // æ˜¾ç¤ºæ ‡æ³¨è¡¨æ ¼
        function displayAnnotationTable(data, columns, pagination) {
            const tableHead = document.getElementById('dataTableHead');
            const tableBody = document.getElementById('dataTableBody');
            
            columnConfigs = columns;
            
            // æ„å»ºè¡¨å¤´ - åŒ…å«åˆ—å®½åº¦è®¾ç½®
            const headerCells = [{ name: 'åºå·', width: 60 }];
            columns.filter(col => col.is_visible).forEach(col => {
                headerCells.push({ 
                    name: col.display_name, 
                    width: col.column_width || 150 
                });
            });
            
            // æ·»åŠ æ ‡æ³¨åˆ—å¤´
            const config = currentProject.config || {};
            const annotationConfigs = config.annotation_configs || [];
            annotationConfigs.forEach(annConfig => {
                headerCells.push({ 
                    name: annConfig.fieldName, 
                    width: 200 
                });
            });
            
            // è®¾ç½®è¡¨æ ¼åˆ—å®½åº¦
            let colWidthStyle = '';
            headerCells.forEach((header, index) => {
                colWidthStyle += `.data-table th:nth-child(${index + 1}), .data-table td:nth-child(${index + 1}) { width: ${header.width}px; max-width: ${header.width}px; } `;
            });
            
            // æ›´æ–°æˆ–åˆ›å»ºæ ·å¼
            let styleElement = document.getElementById('tableWidthStyles');
            if (!styleElement) {
                styleElement = document.createElement('style');
                styleElement.id = 'tableWidthStyles';
                document.head.appendChild(styleElement);
            }
            styleElement.textContent = colWidthStyle;
            
            tableHead.innerHTML = `
                <tr>
                    ${headerCells.map(header => `<th title="${header.name}">${header.name}</th>`).join('')}
                </tr>
            `;
            
            // æ„å»ºæ•°æ®è¡Œ
            tableBody.innerHTML = '';
            data.forEach((row, index) => {
                const tr = document.createElement('tr');
                
                // åºå·
                tr.innerHTML += `<td>${(currentPage - 1) * pageSize + index + 1}</td>`;
                
                // åŸå§‹æ•°æ®åˆ—
                columns.filter(col => col.is_visible).forEach(col => {
                    const value = row.original_data[col.original_name] || '';
                    let cellContent = '';
                    
                    // æ£€æŸ¥æ˜¯å¦é…ç½®ä¸ºURLåˆ—
                    if (col.is_url && value && (value.startsWith('http://') || value.startsWith('https://'))) {
                        const displayUrl = truncateUrl(value, col.column_width);
                        const openMethod = col.url_new_window ? 'openUrlInPopup' : 'openUrlInTab';
                        cellContent = `<span class="url-link" onclick="${openMethod}('${value}')" title="${value}">${displayUrl}</span>`;
                    } else if (col.is_searchable && col.search_api) {
                        // å¦‚æœåˆ—é…ç½®ä¸ºå¯æœç´¢ï¼Œæ·»åŠ æœç´¢æŒ‰é’®
                        cellContent = `
                            <div style="display: flex; align-items: center; gap: 5px;">
                                <span title="${value}" style="flex: 1; overflow: hidden; text-overflow: ellipsis;">${value}</span>
                                <button class="btn btn-outline" onclick="searchColumnContent('${value.replace(/'/g, "&apos;")}', '${col.search_api}')" 
                                        style="padding: 2px 6px; font-size: 11px; flex-shrink: 0;">ğŸ”</button>
                            </div>
                        `;
                    } else {
                        cellContent = `<span title="${value}">${value}</span>`;
                    }
                    
                    tr.innerHTML += `<td>${cellContent}</td>`;
                });
                
                // æ ‡æ³¨åˆ—
                annotationConfigs.forEach(annConfig => {
                    const cellValue = row.annotations[annConfig.fieldName] || '';
                    let cellHTML = '<td>';
                    
                    if (annConfig.labelText) {
                        cellHTML += `<span class="annotation-label">${annConfig.labelText}</span>`;
                    }
                    
                    // æ ¹æ®è¾“å…¥ç±»å‹ç”Ÿæˆä¸åŒçš„è¾“å…¥æ¡†
                    if (annConfig.inputType === 'select') {
                        cellHTML += `<select class="annotation-input" onchange="saveAnnotation(${row.id}, '${annConfig.fieldName}', this.value)">`;
                        cellHTML += '<option value="">è¯·é€‰æ‹©</option>';
                        annConfig.options.forEach(option => {
                            cellHTML += `<option value="${option}" ${cellValue === option ? 'selected' : ''}>${option}</option>`;
                        });
                        cellHTML += '</select>';
                    } else if (annConfig.inputType === 'number') {
                        cellHTML += `<input type="number" class="annotation-input" 
                                          min="${annConfig.minValue || ''}" 
                                          max="${annConfig.maxValue || ''}"
                                          value="${cellValue}" 
                                          onchange="saveAnnotation(${row.id}, '${annConfig.fieldName}', this.value)">`;
                    } else {
                        cellHTML += `<input type="text" class="annotation-input" 
                                          value="${cellValue}" 
                                          onchange="saveAnnotation(${row.id}, '${annConfig.fieldName}', this.value)">`;
                    }
                    
                    if (annConfig.isSearchable && annConfig.searchApi) {
                        cellHTML += `<button class="btn btn-outline" onclick="searchContent(${row.id}, '${annConfig.fieldName}', '${annConfig.searchApi}')" 
                                            style="margin-left: 5px; padding: 3px 8px; font-size: 11px;">ğŸ”</button>`;
                    }
                    
                    cellHTML += '</td>';
                    tr.innerHTML += cellHTML;
                });
                
                tableBody.appendChild(tr);
            });
        }
        
        // æˆªæ–­URLæ˜¾ç¤º
        function truncateUrl(url, maxWidth) {
            const avgCharWidth = 8; // ä¼°ç®—å­—ç¬¦å®½åº¦
            const maxChars = Math.floor((maxWidth - 40) / avgCharWidth); // 40pxç•™ç»™å…¶ä»–å…ƒç´ 
            
            if (url.length <= maxChars) {
                return url;
            }
            
            // ä¿ç•™åè®®å’ŒåŸŸåï¼Œæˆªæ–­è·¯å¾„éƒ¨åˆ†
            const urlParts = url.match(/^(https?:\/\/[^\/]+)(.*)/);
            if (urlParts && urlParts[1].length < maxChars - 10) {
                const domain = urlParts[1];
                const path = urlParts[2];
                const remainingChars = maxChars - domain.length - 3; // 3 for "..."
                if (remainingChars > 0) {
                    return domain + '...' + path.slice(-remainingChars);
                }
            }
            
            // å¦‚æœåŸŸåå¤ªé•¿ï¼Œç›´æ¥æˆªæ–­
            return url.slice(0, maxChars - 3) + '...';
        }
        
        // åœ¨å°çª—å£ä¸­æ‰“å¼€URL
        function openUrlInPopup(url) {
            const popup = window.open(
                url,
                'urlPopup',
                'width=1000,height=700,scrollbars=yes,resizable=yes,toolbar=no,menubar=no,location=no,status=no'
            );
            
            if (popup) {
                popup.focus();
            } else {
                alert('å¼¹çª—è¢«é˜»æ­¢ï¼Œè¯·æ£€æŸ¥æµè§ˆå™¨è®¾ç½®æˆ–ç›´æ¥è®¿é—®ï¼š\n' + url);
            }
        }
        
        // åœ¨æ–°æ ‡ç­¾é¡µä¸­æ‰“å¼€URL
        function openUrlInTab(url) {
            window.open(url, '_blank');
        }
        
        // åˆ‡æ¢åˆ—æœç´¢é€‰é¡¹
        function toggleColumnSearch(index) {
            const searchConfig = document.getElementById(`searchApi_${index}`);
            const isSearchable = document.getElementById(`searchable_${index}`).checked;
            searchConfig.style.display = isSearchable ? 'block' : 'none';
        }
        async function searchColumnContent(searchText, searchApi) {
            if (!searchApi) {
                alert('æœªé…ç½®æœç´¢API');
                return;
            }
            
            const modal = document.getElementById('searchModal');
            const resultsDiv = document.getElementById('searchResults');
            
            resultsDiv.innerHTML = '<p>æ­£åœ¨æœç´¢...</p>';
            modal.classList.add('active');
            
            try {
                const response = await fetch(`${API_BASE}/api/projects/${currentProject.id}/search`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        search_text: searchText,
                        search_api: searchApi
                    })
                });
                
                const result = await response.json();
                
                if (response.ok && result.results) {
                    let html = `<h4>æœç´¢å…³é”®è¯: ${searchText}</h4>`;
                    html += '<div style="margin-top: 15px;">';
                    
                    if (result.results.items) {
                        result.results.items.forEach((item, index) => {
                            html += `<div style="padding: 10px; border: 1px solid #e9ecef; border-radius: 8px; margin-bottom: 10px;">
                                <strong>ç»“æœ ${index + 1}:</strong> ${item.title || ''}
                                <br><small>${item.snippet || ''}</small>
                            </div>`;
                        });
                    }
                    
                    html += '</div>';
                    resultsDiv.innerHTML = html;
                } else {
                    resultsDiv.innerHTML = '<p>æœç´¢å¤±è´¥æˆ–æ— ç»“æœ</p>';
                }
            } catch (error) {
                console.error('æœç´¢å¤±è´¥:', error);
                resultsDiv.innerHTML = '<p>æœç´¢è¯·æ±‚å¤±è´¥</p>';
            }
        }
        
        // ä¿å­˜æ ‡æ³¨
        async function saveAnnotation(rowId, fieldName, value) {
            if (!currentProject) return;
            
            try {
                const response = await fetch(`${API_BASE}/api/projects/${currentProject.id}/annotations`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        row_id: rowId,
                        annotations: { [fieldName]: value }
                    })
                });
                
                if (!response.ok) {
                    const error = await response.json();
                    alert(error.message || 'ä¿å­˜å¤±è´¥');
                }
            } catch (error) {
                console.error('ä¿å­˜æ ‡æ³¨å¤±è´¥:', error);
            }
        }
        
        // æœç´¢å†…å®¹
        async function searchContent(rowId, fieldName, searchApi) {
            if (!searchApi) {
                alert('æœªé…ç½®æœç´¢API');
                return;
            }
            
            const modal = document.getElementById('searchModal');
            const resultsDiv = document.getElementById('searchResults');
            
            resultsDiv.innerHTML = '<p>æ­£åœ¨æœç´¢...</p>';
            modal.classList.add('active');
            
            try {
                const response = await fetch(`${API_BASE}/api/projects/${currentProject.id}/search`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        search_text: 'search query',
                        search_api: searchApi
                    })
                });
                
                const result = await response.json();
                
                if (response.ok && result.results) {
                    let html = `<h4>æœç´¢å…³é”®è¯: ${result.search_text}</h4>`;
                    html += '<div style="margin-top: 15px;">';
                    
                    if (result.results.items) {
                        result.results.items.forEach((item, index) => {
                            html += `<p><strong>æœç´¢ç»“æœ ${index + 1}:</strong> ${item.snippet || item.title}</p>`;
                        });
                    }
                    
                    html += '</div>';
                    html += `<div style="margin-top: 20px;">
                        <label class="form-label">åŸºäºæœç´¢ç»“æœçš„å»ºè®®ï¼š</label>
                        <input type="text" class="form-control" placeholder="è¾“å…¥æ ‡æ³¨å€¼" 
                               onkeypress="if(event.key==='Enter') applySearchResult(${rowId}, '${fieldName}', this.value)">
                        <button class="btn btn-primary" onclick="applySearchResult(${rowId}, '${fieldName}', this.previousElementSibling.value)" 
                                style="margin-top: 10px;">åº”ç”¨</button>
                    </div>`;
                    
                    resultsDiv.innerHTML = html;
                } else {
                    resultsDiv.innerHTML = '<p>æœç´¢å¤±è´¥æˆ–æ— ç»“æœ</p>';
                }
            } catch (error) {
                resultsDiv.innerHTML = '<p>æœç´¢è¯·æ±‚å¤±è´¥</p>';
            }
        }
        
        // åº”ç”¨æœç´¢ç»“æœ
        function applySearchResult(rowId, fieldName, value) {
            if (value) {
                const input = document.querySelector(`input[onchange*="${rowId}"][onchange*="${fieldName}"]`);
                if (input) {
                    input.value = value;
                    saveAnnotation(rowId, fieldName, value);
                }
                closeModal('searchModal');
            }
        }
        
        // æ›´æ–°åˆ†é¡µä¿¡æ¯
        function updatePaginationInfo(pagination) {
            currentPage = pagination.page;
            totalPages = pagination.pages;
            
            document.getElementById('paginationInfo').textContent = 
                `ç¬¬ ${currentPage} é¡µï¼Œå…± ${totalPages} é¡µ (æ€»è®¡ ${pagination.total} æ¡)`;
        }
        
        // æ”¹å˜æ¯é¡µå¤§å°
        function changePageSize() {
            pageSize = parseInt(document.getElementById('pageSize').value);
            currentPage = 1;
            loadAnnotationData();
        }
        
        // ä¸Šä¸€é¡µ
        function previousPage() {
            if (currentPage > 1) {
                currentPage--;
                loadAnnotationData();
            }
        }
        
        // ä¸‹ä¸€é¡µ
        function nextPage() {
            if (currentPage < totalPages) {
                currentPage++;
                loadAnnotationData();
            }
        }
        
        // åŠ è½½ç»Ÿè®¡ä¿¡æ¯
        async function loadStatistics() {
            if (!currentProject) return;
            
            try {
                const response = await fetch(`${API_BASE}/api/projects/${currentProject.id}/statistics`);
                const stats = await response.json();
                
                if (response.ok) {
                    displayStatistics(stats);
                }
            } catch (error) {
                console.error('åŠ è½½ç»Ÿè®¡ä¿¡æ¯å¤±è´¥:', error);
            }
        }
        
        // æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯
        function displayStatistics(stats) {
            const statsGrid = document.getElementById('statsGrid');
            
            statsGrid.innerHTML = `
                <div class="stat-card">
                    <div class="stat-label">æ€»æ•°æ®é‡</div>
                    <div class="stat-value">${stats.total_count}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">å·²æ ‡æ³¨</div>
                    <div class="stat-value">${stats.annotated_count}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">å®Œæˆç‡</div>
                    <div class="stat-value">${stats.completion_rate}%</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">å¹³å‡è¯„åˆ†</div>
                    <div class="stat-value">${stats.avg_rating || '-'}</div>
                </div>
            `;
        }
        
        // å¯¼å‡ºæ•°æ®
        async function exportData() {
            if (!currentProject) return;
            
            const format = document.getElementById('exportFormat').value;
            const includeOriginal = document.getElementById('includeOriginal').checked;
            const includeAnnotations = document.getElementById('includeAnnotations').checked;
            const includeStats = document.getElementById('includeStats').checked;
            
            try {
                const response = await fetch(`${API_BASE}/api/projects/${currentProject.id}/export`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        format,
                        include_original: includeOriginal,
                        include_annotations: includeAnnotations,
                        include_stats: includeStats
                    })
                });
                
                if (response.ok) {
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.style.display = 'none';
                    a.href = url;
                    a.download = `${currentProject.name}_export.${format}`;
                    document.body.appendChild(a);
                    a.click();
                    window.URL.revokeObjectURL(url);
                    document.body.removeChild(a);
                    
                    alert('å¯¼å‡ºæˆåŠŸï¼');
                } else {
                    const error = await response.json();
                    alert(error.message || 'å¯¼å‡ºå¤±è´¥');
                }
            } catch (error) {
                console.error('å¯¼å‡ºå¤±è´¥:', error);
                alert('å¯¼å‡ºå¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥');
            }
        }
        
        // å…³é—­æ¨¡æ€æ¡†
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }
        
        // ç‚¹å‡»æ¨¡æ€æ¡†èƒŒæ™¯å…³é—­
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', function(e) {
                if (e.target === this) {
                    this.classList.remove('active');
                }
            });
        });
    </script>
</body>
</html>